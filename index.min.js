"use strict";var execSync=require("child_process").execSync;var fs=require("fs");var path=require("path");var os=require("os");var dateFormat=function t(r,n){var e=void 0;var c={"Y+":n.getFullYear().toString(),"m+":(n.getMonth()+1).toString(),"d+":n.getDate().toString(),"H+":n.getHours().toString(),"M+":n.getMinutes().toString(),"S+":n.getSeconds().toString()};for(var a in c){e=new RegExp("("+a+")").exec(r);if(e){r=r.replace(e[1],e[1].length===1?c[a]:c[a].padStart(e[1].length,"0"))}}return r};var BranchPlugin=function t(r){r=r||{};this.options=r};BranchPlugin.prototype.apply=function(D){var F=this;D.hooks.afterEmit.tap("branch-plugin",function(){var t="\n",r="\n",n="\n",e="\n",c="\n",a="\n";try{r=process.env["npm_lifecycle_script"].toString().trim()}catch(t){}try{t=execSync("git rev-parse --abbrev-ref HEAD")}catch(t){}try{n=execSync("git config user.name")}catch(t){}try{e=execSync("git config user.email")}catch(t){}try{c=dateFormat("YYYY-mm-dd HH:MM:SS",new Date)}catch(t){}a="资源包提供者："+n+"执行脚本："+r+"\n邮箱："+e+"生成日期："+c+"\n发布分支："+t+new Array(80).join("*")+"\n";var i="",o="",s="",g="",h="",y="";try{i=execSync("git show -s --format=%H").toString().trim()}catch(t){}try{o=execSync("git show -s --format=%cn").toString().trim()}catch(t){}try{s=execSync("git show -s --format=%ce").toString().trim()}catch(t){}try{g=new Date(execSync("git show -s --format=%cd").toString())}catch(t){}try{h=execSync("git show -s --format=%s").toString().trim()}catch(t){}if(i||o||s||g||h){y="最近一次提交：\ngit："+i+"\n作者："+o+"<"+s+">\n日期："+(g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate()+" "+g.getHours()+":"+g.getMinutes())+"\n说明："+h+"\n"+new Array(80).join("*")+"\n"}var S="",m="",p="",f="",u="",l="",v="",d="",x="";try{S=execSync("node -v").toString().trim()}catch(t){}try{m=execSync("npm -v").toString().trim()}catch(t){}try{p=__dirname}catch(t){}try{f=os.type()}catch(t){}try{u=os.platform()}catch(t){}try{l=os.arch()}catch(t){}try{v=os.hostname()}catch(t){}try{d=os.release()}catch(t){}if(S||m||p||f||u||l||v||d){x="环境信息：\nnode版本："+S+"\nnpm版本："+m+"\n项目文件夹："+p+"\n操作系统名称："+f+"\n操作系统类型："+u+"\n处理器架构："+l+"\n操作系统主机名："+v+"\n操作系统版本："+d+"\n"+new Array(80).join("*")+"\n"}var w=D.options.output||{},H=w.path;var M=F.options||{},Y=M.filename;if(!Y.startsWith("/")){Y="/"+Y}try{fs.writeFileSync(path.join(H+Y),a+y+x,{encoding:"utf-8",mode:438,flag:"w"})}catch(t){}})};module.exports=BranchPlugin;